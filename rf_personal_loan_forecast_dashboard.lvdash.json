{
  "datasets": [
    {
      "name": "dd2dda8e",
      "displayName": "Exactitud",
      "queryLines": [
        "SELECT \r\n",
        "    ROUND(AVG(CASE WHEN personal_loan_real = personal_loan_pred THEN 1 ELSE 0 END)*100,2) AS accuracy\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n"
      ]
    },
    {
      "name": "8fb75375",
      "displayName": "Tasa de aceptación real",
      "queryLines": [
        "SELECT ROUND(AVG(personal_loan_real)*100,2) AS pct_real_acceptance\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast"
      ]
    },
    {
      "name": "d8e855b8",
      "displayName": "Tasa de aceptación predicha",
      "queryLines": [
        "SELECT ROUND(AVG(personal_loan_pred)*100,2) AS pct_pred_acceptance\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast"
      ]
    },
    {
      "name": "ea704dc8",
      "displayName": "Comparación real vs predicha (Conf Matrix)",
      "queryLines": [
        "SELECT personal_loan_real, personal_loan_pred, COUNT(*) AS count\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY personal_loan_real, personal_loan_pred"
      ]
    },
    {
      "name": "e11e94e8",
      "displayName": "Distribuciones por segmento - educación",
      "queryLines": [
        "SELECT education, ROUND(AVG(personal_loan_real), 2) AS real_rate, ROUND(AVG(personal_loan_pred), 2) AS pred_rate\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY education"
      ]
    },
    {
      "name": "c181ad37",
      "displayName": "ZIP Code / geografía",
      "queryLines": [
        "SELECT zip_code, AVG(personal_loan_real) AS real_rate, AVG(personal_loan_pred) AS pred_rate\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY zip_code\r\n",
        "ORDER BY zip_code"
      ]
    },
    {
      "name": "8dcc583b",
      "displayName": "Comparación por uso de productos del banco",
      "queryLines": [
        "SELECT \r\n",
        "    securities_account,\r\n",
        "    AVG(personal_loan_real) AS real_rate,\r\n",
        "    AVG(personal_loan_pred) AS pred_rate\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY securities_account\r\n"
      ]
    },
    {
      "name": "1433979a",
      "displayName": "Distribuciones por segmento - familia",
      "queryLines": [
        "SELECT family, AVG(personal_loan_real) AS real_rate, AVG(personal_loan_pred) AS pred_rate\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY family\r\n",
        "ORDER BY family DESC"
      ]
    },
    {
      "name": "4fa3636b",
      "displayName": "Precisión",
      "queryLines": [
        "SELECT ROUND(SUM(CASE WHEN personal_loan_real=1 AND personal_loan_pred=1 THEN 1 ELSE 0 END) \r\n",
        "           / NULLIF(SUM(CASE WHEN personal_loan_pred=1 THEN 1 ELSE 0 END),0)*100,2) AS precision\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast;"
      ]
    },
    {
      "name": "99e92679",
      "displayName": "Re call",
      "queryLines": [
        "SELECT ROUND(SUM(CASE WHEN personal_loan_real=1 AND personal_loan_pred=1 THEN 1 ELSE 0 END) \r\n",
        "           / NULLIF(SUM(CASE WHEN personal_loan_real=1 THEN 1 ELSE 0 END),0)*100,2) AS recall\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast;"
      ]
    },
    {
      "name": "be285b4d",
      "displayName": "F1 Score",
      "queryLines": [
        "WITH preds AS (\r\n",
        "  SELECT\r\n",
        "    CAST(personal_loan_real AS INT) AS real,\r\n",
        "    CAST(personal_loan_pred AS INT) AS pred\r\n",
        "  FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "),\r\n",
        "counts AS (\r\n",
        "  SELECT\r\n",
        "    SUM(CASE WHEN real = 1 AND pred = 1 THEN 1 ELSE 0 END) AS TP,\r\n",
        "    SUM(CASE WHEN real = 0 AND pred = 1 THEN 1 ELSE 0 END) AS FP,\r\n",
        "    SUM(CASE WHEN real = 1 AND pred = 0 THEN 1 ELSE 0 END) AS FN,\r\n",
        "    SUM(CASE WHEN real = 0 AND pred = 0 THEN 1 ELSE 0 END) AS TN,\r\n",
        "    COUNT(*) AS total\r\n",
        "  FROM preds\r\n",
        ")\r\n",
        "SELECT\r\n",
        "  TP, FP, FN, TN, total,\r\n",
        "  ROUND(100.0 * TP / NULLIF(TP + FP, 0), 2) AS precision_pct,\r\n",
        "  ROUND(100.0 * TP / NULLIF(TP + FN, 0), 2) AS recall_pct,\r\n",
        "  ROUND(100.0 * (2 * TP) / NULLIF(2 * TP + FP + FN, 0), 2) AS f1_pct,\r\n",
        "  ROUND(100.0 * (TP + TN) / NULLIF(total, 0), 2) AS accuracy_pct\r\n",
        "FROM counts;\r\n"
      ]
    },
    {
      "name": "9db7988d",
      "displayName": "Distribuciones por segmento - online",
      "queryLines": [
        "SELECT online, AVG(personal_loan_real) AS real_rate, AVG(personal_loan_pred) AS pred_rate\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast\r\n",
        "GROUP BY online\r\n",
        "ORDER BY online DESC"
      ]
    },
    {
      "name": "fc1d0473",
      "displayName": "Media/Dev Std originales",
      "queryLines": [
        "SELECT \r\n",
        "  AVG(income) AS mean_income,\r\n",
        "  STDDEV(income) AS std_income,\r\n",
        "  AVG(experience) AS mean_experience,\r\n",
        "  STDDEV(experience) AS std_experience\r\n",
        "FROM bank_loan.default.etl_bank_loan_bronze;"
      ]
    },
    {
      "name": "77f74e92",
      "displayName": "Experiencia Vs Income",
      "queryLines": [
        "SELECT\r\n",
        "  ABS(income_scaled * 46.03372932108631 + 73.7742) AS income_original,\r\n",
        "  ABS(experience_scaled * 11.467953681120553 + 0.1046) AS experience_original,\r\n",
        "  personal_loan_real,\r\n",
        "  personal_loan_pred\r\n",
        "FROM bank_loan.default.rf_personal_loan_forecast;\r\n"
      ]
    }
  ],
  "pages": [
    {
      "name": "a4f21d90",
      "displayName": "bank_loan_model",
      "layout": [
        {
          "widget": {
            "name": "20918597",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ea704dc8",
                  "fields": [
                    {
                      "name": "count",
                      "expression": "`count`"
                    },
                    {
                      "name": "personal_loan_real",
                      "expression": "`personal_loan_real`"
                    },
                    {
                      "name": "personal_loan_pred",
                      "expression": "`personal_loan_pred`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "heatmap",
              "encodings": {
                "x": {
                  "fieldName": "personal_loan_real",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "personal_loan_pred",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "color": {
                  "fieldName": "count",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "label": {
                  "show": true
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "title": "Comparación real vs predicha"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 2,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "80d0f5bc",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "e11e94e8",
                  "fields": [
                    {
                      "name": "education",
                      "expression": "`education`"
                    },
                    {
                      "name": "real_rate",
                      "expression": "`real_rate`"
                    },
                    {
                      "name": "pred_rate",
                      "expression": "`pred_rate`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "education",
                  "scale": {
                    "type": "quantitative",
                    "reverse": false
                  }
                },
                "y": {
                  "scale": {
                    "type": "quantitative"
                  },
                  "fields": [
                    {
                      "fieldName": "real_rate"
                    },
                    {
                      "fieldName": "pred_rate"
                    }
                  ]
                },
                "label": {
                  "show": false
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "showDescription": false,
                "title": "Distribuciones por segmento - educación"
              },
              "mark": {
                "colors": [
                  {
                    "themeColorType": "visualizationColors",
                    "position": 4
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 2
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 3
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 4
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 5
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 6
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 7
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 8
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 9
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 10
                  }
                ]
              }
            }
          },
          "position": {
            "x": 3,
            "y": 0,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "4b5cb397",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "dd2dda8e",
                  "fields": [
                    {
                      "name": "sum(accuracy)",
                      "expression": "SUM(`accuracy`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(accuracy)"
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "title": "Exactitud del modelo"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 3,
            "width": 1,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "f8e5674d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1433979a",
                  "fields": [
                    {
                      "name": "family",
                      "expression": "`family`"
                    },
                    {
                      "name": "real_rate",
                      "expression": "`real_rate`"
                    },
                    {
                      "name": "pred_rate",
                      "expression": "`pred_rate`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "family",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "scale": {
                    "type": "quantitative"
                  },
                  "fields": [
                    {
                      "fieldName": "real_rate"
                    },
                    {
                      "fieldName": "pred_rate"
                    }
                  ]
                },
                "label": {
                  "show": false
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "showDescription": false,
                "title": "Distribuciones por segmento - familia"
              },
              "mark": {
                "colors": [
                  {
                    "themeColorType": "visualizationColors",
                    "position": 7
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 8
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 3
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 4
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 5
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 6
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 7
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 8
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 9
                  },
                  {
                    "themeColorType": "visualizationColors",
                    "position": 10
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 7,
            "width": 3,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "06093017",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "4fa3636b",
                  "fields": [
                    {
                      "name": "precision",
                      "expression": "`precision`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "precision"
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "title": "Precisión del modelo"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 5,
            "width": 3,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "a9ae5fd7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "99e92679",
                  "fields": [
                    {
                      "name": "recall",
                      "expression": "`recall`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "recall"
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "title": "Re call del modelo"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 3,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "484810ad",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "be285b4d",
                  "fields": [
                    {
                      "name": "f1_pct",
                      "expression": "`f1_pct`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "f1_pct"
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "title": "F1 Score del modelo"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 0,
            "width": 1,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "5dcb5d2c",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "77f74e92",
                  "fields": [
                    {
                      "name": "personal_loan_real",
                      "expression": "`personal_loan_real`"
                    },
                    {
                      "name": "experience_original",
                      "expression": "`experience_original`"
                    },
                    {
                      "name": "income_original",
                      "expression": "`income_original`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "scatter",
              "encodings": {
                "x": {
                  "fieldName": "experience_original",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "income_original",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "color": {
                  "fieldName": "personal_loan_real",
                  "scale": {
                    "type": "quantitative",
                    "colorRamp": {
                      "mode": "scheme",
                      "scheme": "reds"
                    }
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "headerAlignment": "center",
                "showDescription": true,
                "title": "Scatter plot Experiencia Vs Income",
                "description": "Se deja ver poca relación entre las variable"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 6,
            "width": 3,
            "height": 5
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "6ca9b183",
      "displayName": "Global Filters",
      "layout": [
        {
          "widget": {
            "name": "5360c20c",
            "spec": {
              "version": 2,
              "widgetType": "filter-single-select",
              "encodings": {},
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 1,
            "height": 2
          }
        }
      ],
      "pageType": "PAGE_TYPE_GLOBAL_FILTERS"
    }
  ],
  "uiSettings": {
    "theme": {
      "widgetHeaderAlignment": "ALIGNMENT_UNSPECIFIED"
    }
  }
}
